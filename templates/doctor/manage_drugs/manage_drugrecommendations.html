{% extends 'basic.html' %}
{% load static %}

{% block head %}
  
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

<style>
  .hover-shadow {
    transition: all 0.3s ease-in-out;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  }

  .hover-shadow:hover {
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    transform: translateY(-4px);

  }
</style>


{% endblock %}

{% block body %}
<div class="container mt-4">
  <h3 class="text-center">Manage Drug Recommendations</h3>
  

  <center>
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-success">{{ message }} by Dr. {{ request.user.doctor.name }}</div>
    {% endfor %}
  {% endif %}
  </center>

  <!-- Add New Recommendation -->
<!-- Toggle Button -->
 <!-- <center>
  <button class="btn btn-success mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#addRecommendationForm">
    <i class="fas fa-briefcase-medical"></i> &nbsp; Add Drug Recommendation
  </button>
 </center> -->

<!-- Add Form (Collapsed) -->
<!-- <div class="collapse" id="addRecommendationForm">
  <form method="POST">
    {% csrf_token %}
    <input type="hidden" name="id" value="">
    <input type="text" name="diseasename" class="form-control mb-2" placeholder="Disease Name" required>
    <textarea name="description" class="form-control mb-2" placeholder="Description"></textarea>
    <textarea name="precautions" class="form-control mb-2" placeholder="Precautions"></textarea>
    <textarea name="medications" class="form-control mb-2" placeholder="Medications"></textarea>
    <textarea name="diet" class="form-control mb-2" placeholder="Diet"></textarea>
    <textarea name="workout" class="form-control mb-2" placeholder="Workout"></textarea>
    <center><button type="submit" name="create" class="btn btn-success mt-2">Add Recommendation</button></center>
  </form>
</div> -->


  <br><br><br>

  <!-- Existing Records -->
  <div class="row">
  {% for rec in recommendations %}
  <div class="col-md-6 mb-4">
    <div class="card shadow-sm border-0 h-100 hover-shadow">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="card-title text-primary mb-0">
            <i class="bi bi-virus"></i>
            {% if rec.diseasename == 'Dimorphic hemmorhoids(piles)' %}
              Hemmorhoids(piles)
            {% elif rec.diseasename == 'Peptic ulcer diseae' %}
               Peptic Ulcer Disease
            {% elif rec.diseasename == 'Drug Reaction' %}
              Adverse Drug Reaction
            {% elif rec.diseasename == 'Chronic cholestasis' %}
              Chronic Cholecystitis
            {% elif rec.diseasename == 'Arthritis' %}
              Rheumatoid Arthritis  
            {% else %}
              {% if  rec.diseasename != 'GERD' and rec.diseasename != 'AIDS' %} 
                {{ rec.diseasename|title }} 
              {% else %} 
                {{ rec.diseasename }} 
              {% endif %}
            {% endif %}
          </h5>

            {% if not rec.is_approved %}
              <!-- Trigger Modal -->
              <button class="btn btn-sm btn-outline-success" data-bs-toggle="modal" data-bs-target="#approveModal{{ rec.id }}">
                <i class="bi bi-check-circle"></i> Approve
              </button>      
          {% else %}
            <span class="badge bg-success">Approved</span>
          {% endif %}
       </div>


        <hr>
        <p><span class="fw-semibold text-muted">üßæ Description:</span><br> {{ rec.description|default:"N/A" }}</p>
        <p><span class="fw-semibold text-muted">‚ö†Ô∏è Precautions:</span><br> {{ rec.precautions|default:"N/A" }}</p>
        <p><span class="fw-semibold text-muted">üíä Medications:</span><br> {{ rec.medications|default:"N/A" }}</p>
        <p><span class="fw-semibold text-muted">ü•ó Diet:</span><br> {{ rec.diet|default:"N/A" }}</p>
        <p><span class="fw-semibold text-muted">üèÉ Workout:</span><br> {{ rec.workout|default:"N/A" }}</p>
        <p><span class="fw-semibold text-muted">üë§ Added By:</span> {{ rec.addedby|default:"N/A" }}</p>
        {% if rec.updatedby %}
        <p><span class="fw-semibold text-muted">‚úèÔ∏è Updated By:</span> Dr. {{ rec.updatedby.name }}</p>
        {% endif %}

        {% if rec.is_approved %}
        <p><span class="fw-semibold text-muted"><i class="bi bi-patch-check-fill text-primary"></i> Approved by: </span> Dr. {{ rec.approvedby.name }}</p>
        {% endif %}

        <div class="d-flex justify-content-end gap-2 mt-3">
          <a href="{% url 'edit_drug_recommendation' rec.id %}" class="btn btn-sm btn-outline-primary">
            <i class="bi bi-pencil-square"></i> Update
          </a>

          <button class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ rec.id }}">
            <i class="bi bi-trash3"></i> Delete
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Approve Confirmation Modal --> 
          <div class="modal fade" id="approveModal{{ rec.id }}" tabindex="-1" aria-labelledby="approveModalLabel{{ rec.id }}" aria-hidden="true">
            <div class="modal-dialog">
              <form method="POST">
                {% csrf_token %}
                <input type="hidden" name="id" value="{{ rec.id }}">
                <div class="modal-content">
                  <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="approveModalLabel{{ rec.id }}">Confirm Approval</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    Are you sure you want to approve the <strong>{{ rec.diseasename }}</strong> recommendation?
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" name="approve" class="btn btn-success">Yes, Approve</button>
                  </div>
                </div>
              </form>
            </div>
          </div>

  <!-- Delete Modal -->
  <div class="modal fade" id="deleteModal{{ rec.id }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ rec.id }}" aria-hidden="true">
    <div class="modal-dialog">
      <form method="POST">
        {% csrf_token %}
        <input type="hidden" name="id" value="{{ rec.id }}">
        <div class="modal-content">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title" id="deleteModalLabel{{ rec.id }}">Confirm Delete</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            Are you sure you want to delete <strong>{{ rec.diseasename }}</strong> recommendation?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" name="delete" class="btn btn-danger">Delete</button>
          </div>
        </div>
      </form>
    </div>
  </div>
  {% endfor %}
</div>


</div>


{% endblock %}
